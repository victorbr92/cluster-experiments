
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Functions to design and run clustered experiments">
      
      
        <meta name="author" content="David Masip">
      
      
        <link rel="canonical" href="https://david26694.github.io/cluster-experiments/api/perturbator.html">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.0, mkdocs-material-8.5.0">
    
    
      
        <title>Perturbators - Cluster Experiments Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.2e8b5541.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cbb835fc.min.css">
        
          
          
          <meta name="theme-color" content="#4051b5">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:300,300i,400,400i,700,700i%7CUbuntu+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Ubuntu";--md-code-font:"Ubuntu Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../style.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="indigo" data-md-color-accent="blue">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#from-cluster_experimentsperturbator-import" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Cluster Experiments Docs" class="md-header__button md-logo" aria-label="Cluster Experiments Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Cluster Experiments Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Perturbators
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/david26694/cluster-experiments" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Cluster Experiments Docs" class="md-nav__button md-logo" aria-label="Cluster Experiments Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Cluster Experiments Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/david26694/cluster-experiments" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          Home
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Home" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Home
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../cupac_example.html" class="md-nav__link">
        Cupac example
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../create_custom_classes.html" class="md-nav__link">
        Custom classes
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Switchback
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Switchback" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Switchback
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../switchback.html" class="md-nav__link">
        Stratified switchback
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../plot_calendars.html" class="md-nav__link">
        Switchback calendar visualization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../plot_calendars_hours.html" class="md-nav__link">
        Visualization - 4-hour switches
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../multivariate.html" class="md-nav__link">
        Multiple treatments
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../aa_test.html" class="md-nav__link">
        AA test clustered
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../paired_ttest.html" class="md-nav__link">
        Paired T test
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../analysis_with_different_hypotheses.html" class="md-nav__link">
        Power comparison under different hypotheses
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../washover_example.html" class="md-nav__link">
        Washover
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10" type="checkbox" id="__nav_10" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_10">
          API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API" data-md-level="1">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="experiment_analysis.html" class="md-nav__link">
        Experiment analysis
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Perturbators
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="perturbator.html" class="md-nav__link md-nav__link--active">
        Perturbators
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator" class="md-nav__link">
    cluster_experiments.perturbator
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.BetaRelativePerturbator" class="md-nav__link">
    BetaRelativePerturbator
  </a>
  
    <nav class="md-nav" aria-label="BetaRelativePerturbator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.BetaRelativePerturbator.from_config" class="md-nav__link">
    from_config()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.BetaRelativePerturbator.perturbate" class="md-nav__link">
    perturbate()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.BetaRelativePositivePerturbator" class="md-nav__link">
    BetaRelativePositivePerturbator
  </a>
  
    <nav class="md-nav" aria-label="BetaRelativePositivePerturbator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.BetaRelativePositivePerturbator.perturbate" class="md-nav__link">
    perturbate()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.BinaryPerturbator" class="md-nav__link">
    BinaryPerturbator
  </a>
  
    <nav class="md-nav" aria-label="BinaryPerturbator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.BinaryPerturbator.perturbate" class="md-nav__link">
    perturbate()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.ConstantPerturbator" class="md-nav__link">
    ConstantPerturbator
  </a>
  
    <nav class="md-nav" aria-label="ConstantPerturbator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.ConstantPerturbator.perturbate" class="md-nav__link">
    perturbate()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.NormalPerturbator" class="md-nav__link">
    NormalPerturbator
  </a>
  
    <nav class="md-nav" aria-label="NormalPerturbator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.NormalPerturbator.from_config" class="md-nav__link">
    from_config()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.NormalPerturbator.get_number_of_treated" class="md-nav__link">
    get_number_of_treated()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.NormalPerturbator.get_scale" class="md-nav__link">
    get_scale()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.NormalPerturbator.perturbate" class="md-nav__link">
    perturbate()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.Perturbator" class="md-nav__link">
    Perturbator
  </a>
  
    <nav class="md-nav" aria-label="Perturbator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.Perturbator.from_config" class="md-nav__link">
    from_config()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.Perturbator.perturbate" class="md-nav__link">
    perturbate()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.RelativePositivePerturbator" class="md-nav__link">
    RelativePositivePerturbator
  </a>
  
    <nav class="md-nav" aria-label="RelativePositivePerturbator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.RelativePositivePerturbator.perturbate" class="md-nav__link">
    perturbate()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.SegmentedBetaRelativePerturbator" class="md-nav__link">
    SegmentedBetaRelativePerturbator
  </a>
  
    <nav class="md-nav" aria-label="SegmentedBetaRelativePerturbator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.SegmentedBetaRelativePerturbator.from_config" class="md-nav__link">
    from_config()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.SegmentedBetaRelativePerturbator.perturbate" class="md-nav__link">
    perturbate()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.UniformPerturbator" class="md-nav__link">
    UniformPerturbator
  </a>
  
    <nav class="md-nav" aria-label="UniformPerturbator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.UniformPerturbator.perturbate" class="md-nav__link">
    perturbate()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="random_splitter.html" class="md-nav__link">
        Splitter
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="cupac_model.html" class="md-nav__link">
        Pre experiment outcome model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="power_config.html" class="md-nav__link">
        Power config
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="power_analysis.html" class="md-nav__link">
        Power analysis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="washover.html" class="md-nav__link">
        Washover
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator" class="md-nav__link">
    cluster_experiments.perturbator
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.BetaRelativePerturbator" class="md-nav__link">
    BetaRelativePerturbator
  </a>
  
    <nav class="md-nav" aria-label="BetaRelativePerturbator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.BetaRelativePerturbator.from_config" class="md-nav__link">
    from_config()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.BetaRelativePerturbator.perturbate" class="md-nav__link">
    perturbate()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.BetaRelativePositivePerturbator" class="md-nav__link">
    BetaRelativePositivePerturbator
  </a>
  
    <nav class="md-nav" aria-label="BetaRelativePositivePerturbator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.BetaRelativePositivePerturbator.perturbate" class="md-nav__link">
    perturbate()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.BinaryPerturbator" class="md-nav__link">
    BinaryPerturbator
  </a>
  
    <nav class="md-nav" aria-label="BinaryPerturbator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.BinaryPerturbator.perturbate" class="md-nav__link">
    perturbate()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.ConstantPerturbator" class="md-nav__link">
    ConstantPerturbator
  </a>
  
    <nav class="md-nav" aria-label="ConstantPerturbator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.ConstantPerturbator.perturbate" class="md-nav__link">
    perturbate()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.NormalPerturbator" class="md-nav__link">
    NormalPerturbator
  </a>
  
    <nav class="md-nav" aria-label="NormalPerturbator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.NormalPerturbator.from_config" class="md-nav__link">
    from_config()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.NormalPerturbator.get_number_of_treated" class="md-nav__link">
    get_number_of_treated()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.NormalPerturbator.get_scale" class="md-nav__link">
    get_scale()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.NormalPerturbator.perturbate" class="md-nav__link">
    perturbate()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.Perturbator" class="md-nav__link">
    Perturbator
  </a>
  
    <nav class="md-nav" aria-label="Perturbator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.Perturbator.from_config" class="md-nav__link">
    from_config()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.Perturbator.perturbate" class="md-nav__link">
    perturbate()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.RelativePositivePerturbator" class="md-nav__link">
    RelativePositivePerturbator
  </a>
  
    <nav class="md-nav" aria-label="RelativePositivePerturbator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.RelativePositivePerturbator.perturbate" class="md-nav__link">
    perturbate()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.SegmentedBetaRelativePerturbator" class="md-nav__link">
    SegmentedBetaRelativePerturbator
  </a>
  
    <nav class="md-nav" aria-label="SegmentedBetaRelativePerturbator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.SegmentedBetaRelativePerturbator.from_config" class="md-nav__link">
    from_config()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.SegmentedBetaRelativePerturbator.perturbate" class="md-nav__link">
    perturbate()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.UniformPerturbator" class="md-nav__link">
    UniformPerturbator
  </a>
  
    <nav class="md-nav" aria-label="UniformPerturbator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.UniformPerturbator.perturbate" class="md-nav__link">
    perturbate()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/david26694/cluster-experiments/blob/main/docs/api/perturbator.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="from-cluster_experimentsperturbator-import"><code>from cluster_experiments.perturbator import *</code><a class="headerlink" href="#from-cluster_experimentsperturbator-import" title="Permanent link">&para;</a></h1>


  <div class="doc doc-object doc-module">

<a id="cluster_experiments.perturbator"></a>
    <div class="doc doc-contents first">




  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h2 id="cluster_experiments.perturbator.BetaRelativePerturbator" class="doc doc-heading">
        <code>
BetaRelativePerturbator            (<a class="autorefs autorefs-internal" title="cluster_experiments.perturbator.NormalPerturbator" href="#cluster_experiments.perturbator.NormalPerturbator">NormalPerturbator</a>, <a class="autorefs autorefs-internal" title="cluster_experiments.perturbator.RelativePositivePerturbator" href="#cluster_experiments.perturbator.RelativePositivePerturbator">RelativePositivePerturbator</a>)
        </code>



<a href="#cluster_experiments.perturbator.BetaRelativePerturbator" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>A stochastic Perturbator for continuous targets that applies a  sampled
effect from a scaled Beta distribution. It applies the effect multiplicatively.</p>
<p>The sampled effect is defined for values in the specified range
(range_min, range_max). It's recommended to set -1&lt;range_min&lt;0 and
range_max&gt;0 in a "symmetric way" around 0, such that
log(1 + range_min) = -log(1 + range_max).
This ensures to have an "symmetric range" of perturbations that relatively
decrease the target as perturbations that relatively increase the target.
By "symmetry" of relative effects we mean that for an effect c &gt; 0, an
increase of the target t via t*(1 + c) is "symmetric" to a decrease of t
via t/(1 + c). For example, an increase of 5x (i.e. by +400%, corresponding
to c_inc=4) is "symmetric" to a decrease of 5x (i.e. a decrease of -80%,
corresponding to c_dec = -0.8). In this case, 1 + c_dec = 1/(1 + c_inc), so
the relative effects c_inc and c_dec are "symmetric" in the sense that they
are inverse to each other.</p>
<p>The number of samples with 0 as target remains unchanged.</p>
<p>The stochastic effect is sampled from a beta distribution with parameters
mean and variance, which is linearly scaled to the range
(range_min, range_max).
If variance is not provided, the variance is abs(mean).</p>
<div class="highlight"><pre><span></span><code>target -&gt; target * (1 + effect), where effect ~ Beta(a, b)
</code></pre></div>
<p>The common beta parameters are derived from the mean and scale parameters,
combined with linear transformations to ensure the support in the given
range. The resulting beta parameters are scaled by abs(mu) to narrow the
beta distribution around the mean.</p>
<div class="highlight"><pre><span></span><code>mu_transformed &lt;- (mu - range_min) / (range_max - range_min)
scale_transformed &lt;- (scale - range_min) / (range_max - range_min)
a &lt;- mu_transformed / (scale_transformed * scale_transformed)
b &lt;- (1-mu_transformed) / (scale_transformed * scale_transformed)
effect_transformed ~ beta(a/abs(mu), b/abs(mu))
effect = effect_transformed * (range_max - range_min) + range_min
</code></pre></div>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>average_effect</code></td>
        <td><code>Optional[float]</code></td>
        <td><p>the average effect of the treatment. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>target_col</code></td>
        <td><code>str</code></td>
        <td><p>name of the target_col to use as the outcome. Defaults to "target".</p></td>
        <td><code>&#39;target&#39;</code></td>
      </tr>
      <tr>
        <td><code>treatment_col</code></td>
        <td><code>str</code></td>
        <td><p>the name of the column that contains the treatment. Defaults to "treatment".</p></td>
        <td><code>&#39;treatment&#39;</code></td>
      </tr>
      <tr>
        <td><code>treatment</code></td>
        <td><code>str</code></td>
        <td><p>name of the treatment to use as the treated group. Defaults to "B".</p></td>
        <td><code>&#39;B&#39;</code></td>
      </tr>
      <tr>
        <td><code>scale</code></td>
        <td><code>Optional[float]</code></td>
        <td><p>the scale of the effect distribution. Defaults to None.
If not provided, the variance of the beta distribution is abs(mean).</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>range_min</code></td>
        <td><code>float</code></td>
        <td><p>the minimum value of the target range, must be &gt;-1.
Defaults to -0.8, which allows for up to 5x decreases of the target.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>range_max</code></td>
        <td><code>float</code></td>
        <td><p>the maximum value of the target range.
Defaults to 4, which allows for up to 5x increases of the target.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>reduce_variance</code></td>
        <td><code>Optional[bool]</code></td>
        <td><p>if True and if abs(average_effect)&lt;1, we reduce
the variance of the beta distribution by multiplying the beta parameters by 1/abs(average_effect).
Defaults to None, which is equivalent to True.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">BetaRelativePerturbator</span><span class="p">(</span><span class="n">NormalPerturbator</span><span class="p">,</span> <span class="n">RelativePositivePerturbator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A stochastic Perturbator for continuous targets that applies a  sampled</span>
<span class="sd">    effect from a scaled Beta distribution. It applies the effect multiplicatively.</span>

<span class="sd">    The sampled effect is defined for values in the specified range</span>
<span class="sd">    (range_min, range_max). It&#39;s recommended to set -1&lt;range_min&lt;0 and</span>
<span class="sd">    range_max&gt;0 in a &quot;symmetric way&quot; around 0, such that</span>
<span class="sd">    log(1 + range_min) = -log(1 + range_max).</span>
<span class="sd">    This ensures to have an &quot;symmetric range&quot; of perturbations that relatively</span>
<span class="sd">    decrease the target as perturbations that relatively increase the target.</span>
<span class="sd">    By &quot;symmetry&quot; of relative effects we mean that for an effect c &gt; 0, an</span>
<span class="sd">    increase of the target t via t*(1 + c) is &quot;symmetric&quot; to a decrease of t</span>
<span class="sd">    via t/(1 + c). For example, an increase of 5x (i.e. by +400%, corresponding</span>
<span class="sd">    to c_inc=4) is &quot;symmetric&quot; to a decrease of 5x (i.e. a decrease of -80%,</span>
<span class="sd">    corresponding to c_dec = -0.8). In this case, 1 + c_dec = 1/(1 + c_inc), so</span>
<span class="sd">    the relative effects c_inc and c_dec are &quot;symmetric&quot; in the sense that they</span>
<span class="sd">    are inverse to each other.</span>

<span class="sd">    The number of samples with 0 as target remains unchanged.</span>

<span class="sd">    The stochastic effect is sampled from a beta distribution with parameters</span>
<span class="sd">    mean and variance, which is linearly scaled to the range</span>
<span class="sd">    (range_min, range_max).</span>
<span class="sd">    If variance is not provided, the variance is abs(mean).</span>

<span class="sd">    ```</span>
<span class="sd">    target -&gt; target * (1 + effect), where effect ~ Beta(a, b)</span>
<span class="sd">    ```</span>

<span class="sd">    The common beta parameters are derived from the mean and scale parameters,</span>
<span class="sd">    combined with linear transformations to ensure the support in the given</span>
<span class="sd">    range. The resulting beta parameters are scaled by abs(mu) to narrow the</span>
<span class="sd">    beta distribution around the mean.</span>

<span class="sd">    ```</span>
<span class="sd">    mu_transformed &lt;- (mu - range_min) / (range_max - range_min)</span>
<span class="sd">    scale_transformed &lt;- (scale - range_min) / (range_max - range_min)</span>
<span class="sd">    a &lt;- mu_transformed / (scale_transformed * scale_transformed)</span>
<span class="sd">    b &lt;- (1-mu_transformed) / (scale_transformed * scale_transformed)</span>
<span class="sd">    effect_transformed ~ beta(a/abs(mu), b/abs(mu))</span>
<span class="sd">    effect = effect_transformed * (range_max - range_min) + range_min</span>
<span class="sd">    ```</span>

<span class="sd">    Arguments:</span>
<span class="sd">        average_effect (Optional[float], optional): the average effect of the treatment. Defaults to None.</span>
<span class="sd">        target_col (str, optional): name of the target_col to use as the outcome. Defaults to &quot;target&quot;.</span>
<span class="sd">        treatment_col (str, optional): the name of the column that contains the treatment. Defaults to &quot;treatment&quot;.</span>
<span class="sd">        treatment (str, optional): name of the treatment to use as the treated group. Defaults to &quot;B&quot;.</span>
<span class="sd">        scale (Optional[float], optional): the scale of the effect distribution. Defaults to None.</span>
<span class="sd">            If not provided, the variance of the beta distribution is abs(mean).</span>
<span class="sd">        range_min (float, optional): the minimum value of the target range, must be &gt;-1.</span>
<span class="sd">            Defaults to -0.8, which allows for up to 5x decreases of the target.</span>
<span class="sd">        range_max (float, optional): the maximum value of the target range.</span>
<span class="sd">            Defaults to 4, which allows for up to 5x increases of the target.</span>
<span class="sd">        reduce_variance (Optional[bool], optional): if True and if abs(average_effect)&lt;1, we reduce</span>
<span class="sd">            the variance of the beta distribution by multiplying the beta parameters by 1/abs(average_effect).</span>
<span class="sd">            Defaults to None, which is equivalent to True.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;target&quot;</span><span class="p">,</span>
        <span class="n">treatment_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;treatment&quot;</span><span class="p">,</span>
        <span class="n">treatment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span>
        <span class="n">scale</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">range_min</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">range_max</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">reduce_variance</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_range</span><span class="p">(</span><span class="n">range_min</span><span class="p">,</span> <span class="n">range_max</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">average_effect</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">treatment_col</span><span class="p">,</span> <span class="n">treatment</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_range_min</span> <span class="o">=</span> <span class="n">range_min</span> <span class="ow">or</span> <span class="o">-</span><span class="mf">0.8</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_range_max</span> <span class="o">=</span> <span class="n">range_max</span> <span class="ow">or</span> <span class="mi">4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reduce_variance</span> <span class="o">=</span> <span class="n">reduce_variance</span> <span class="ow">or</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">perturbate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Usage:</span>
<span class="sd">        ```python</span>
<span class="sd">        from cluster_experiments.perturbator import BetaRelativePerturbator</span>
<span class="sd">        import pandas as pd</span>
<span class="sd">        df = pd.DataFrame({&quot;target&quot;: [1, 2, 3], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
<span class="sd">        perturbator = BetaRelativePerturbator(range_min = -0.5, range_max = 2)</span>
<span class="sd">        # Increase target metric by 20% on average</span>
<span class="sd">        perturbator.perturbate(df, average_effect=0.2)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">average_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_average_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_relative_effect_bounds</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_scale</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_relative_effect_bounds</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_treated</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">sampled_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sample_scaled_beta_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_multiplicative_effect</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">sampled_effect</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_check_range</span><span class="p">(</span><span class="n">range_min</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">range_max</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">range_min</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;range_min needs to be greater than -1, got </span><span class="si">{</span><span class="n">range_min</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">range_min</span> <span class="o">&gt;=</span> <span class="n">range_max</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;range_min needs to be smaller than range_max, got &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">range_min</span><span class="w"> </span><span class="si">= }</span><span class="s2"> and </span><span class="si">{</span><span class="n">range_max</span><span class="w"> </span><span class="si">= }</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">check_relative_effect_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_average_effect_greater_than</span><span class="p">(</span><span class="n">average_effect</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_range_min</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_average_effect_smaller_than</span><span class="p">(</span><span class="n">average_effect</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_range_max</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">check_average_effect_greater_than</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NoReturn</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">average_effect</span> <span class="o">&lt;=</span> <span class="n">x</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Simulated effect needs to be greater than range_min=</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">, got </span><span class="si">{</span><span class="n">average_effect</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">check_average_effect_smaller_than</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NoReturn</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">average_effect</span> <span class="o">&gt;=</span> <span class="n">x</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Simulated effect needs to be smaller than range_max=</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">, got </span><span class="si">{</span><span class="n">average_effect</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_reduce_variance_beta_params</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Multiplying the parameters of the beta distribution with a factor &gt;1</span>
<span class="sd">        reduces variance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">*=</span> <span class="mi">1</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">*=</span> <span class="mi">1</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span>

    <span class="k">def</span> <span class="nf">_sample_scaled_beta_effect</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="n">average_effect_inv_transf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inv_transform_to_range</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
        <span class="n">scale_inv_transf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inv_transform_to_range</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">average_effect_inv_transf</span> <span class="o">/</span> <span class="p">(</span><span class="n">scale_inv_transf</span> <span class="o">*</span> <span class="n">scale_inv_transf</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">average_effect_inv_transf</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">scale_inv_transf</span> <span class="o">*</span> <span class="n">scale_inv_transf</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reduce_variance</span><span class="p">:</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reduce_variance_beta_params</span><span class="p">(</span><span class="n">average_effect</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform_to_range</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_transform_to_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]):</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_range_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_range_min</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_range_min</span>

    <span class="k">def</span> <span class="nf">_inv_transform_to_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_range_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_range_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_range_min</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a Perturbator object from a PowerConfig object&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">average_effect</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">average_effect</span><span class="p">,</span>
            <span class="n">target_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">target_col</span><span class="p">,</span>
            <span class="n">treatment_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">,</span>
            <span class="n">treatment</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment</span><span class="p">,</span>
            <span class="n">scale</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span>
            <span class="n">range_min</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">range_min</span><span class="p">,</span>
            <span class="n">range_max</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">range_max</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">













  <div class="doc doc-object doc-method">



<h3 id="cluster_experiments.perturbator.BetaRelativePerturbator.from_config" class="doc doc-heading">
<code class="highlight language-python"><span class="n">from_config</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#cluster_experiments.perturbator.BetaRelativePerturbator.from_config" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Creates a Perturbator object from a PowerConfig object</p>

        <details class="quote">
          <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a Perturbator object from a PowerConfig object&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">average_effect</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">average_effect</span><span class="p">,</span>
        <span class="n">target_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">target_col</span><span class="p">,</span>
        <span class="n">treatment_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">,</span>
        <span class="n">treatment</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment</span><span class="p">,</span>
        <span class="n">scale</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span>
        <span class="n">range_min</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">range_min</span><span class="p">,</span>
        <span class="n">range_max</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">range_max</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="cluster_experiments.perturbator.BetaRelativePerturbator.perturbate" class="doc doc-heading">
<code class="highlight language-python"><span class="n">perturbate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#cluster_experiments.perturbator.BetaRelativePerturbator.perturbate" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Usage:
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">cluster_experiments.perturbator</span> <span class="kn">import</span> <span class="n">BetaRelativePerturbator</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;treatment&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">]})</span>
<span class="n">perturbator</span> <span class="o">=</span> <span class="n">BetaRelativePerturbator</span><span class="p">(</span><span class="n">range_min</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">range_max</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="c1"># Increase target metric by 20% on average</span>
<span class="n">perturbator</span><span class="o">.</span><span class="n">perturbate</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</code></pre></div></p>

        <details class="quote">
          <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">perturbate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Usage:</span>
<span class="sd">    ```python</span>
<span class="sd">    from cluster_experiments.perturbator import BetaRelativePerturbator</span>
<span class="sd">    import pandas as pd</span>
<span class="sd">    df = pd.DataFrame({&quot;target&quot;: [1, 2, 3], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
<span class="sd">    perturbator = BetaRelativePerturbator(range_min = -0.5, range_max = 2)</span>
<span class="sd">    # Increase target metric by 20% on average</span>
<span class="sd">    perturbator.perturbate(df, average_effect=0.2)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">average_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_average_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">check_relative_effect_bounds</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_scale</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">check_relative_effect_bounds</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_treated</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">sampled_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sample_scaled_beta_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_multiplicative_effect</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">sampled_effect</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h2 id="cluster_experiments.perturbator.BetaRelativePositivePerturbator" class="doc doc-heading">
        <code>
BetaRelativePositivePerturbator            (<a class="autorefs autorefs-internal" title="cluster_experiments.perturbator.NormalPerturbator" href="#cluster_experiments.perturbator.NormalPerturbator">NormalPerturbator</a>, <a class="autorefs autorefs-internal" title="cluster_experiments.perturbator.RelativePositivePerturbator" href="#cluster_experiments.perturbator.RelativePositivePerturbator">RelativePositivePerturbator</a>)
        </code>



<a href="#cluster_experiments.perturbator.BetaRelativePositivePerturbator" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>A stochastic Perturbator for continuous, positively-defined targets that applies a
sampled effect from the Beta distribution. It applies the effect multiplicatively.</p>
<p><em>WARNING</em>: the average effect is only defined for values between 0 and 1 (not
included). Therefore, it only increments the target for the treated samples.</p>
<p>The number of samples with 0 as target remains unchanged.</p>
<p>The stochastic effect is sampled from a beta distribution with parameters mean and
variance. If variance is not provided, the variance is abs(mean). Hence, the effect
is bounded by 0 and 1.</p>
<div class="highlight"><pre><span></span><code>target -&gt; target * (1 + effect), where effect ~ Beta(a, b); a, b &gt; 0
                                   and target &gt; 0 for all samples
</code></pre></div>
<p>The common beta parameters are derived from the mean and scale parameters (see
how below). That's why the average effect is only defined for values between 0
and 1, otherwise one of the beta parameters would be negative or zero:</p>
<p><div class="highlight"><pre><span></span><code>a &lt;- mu / (scale * scale)
b &lt;- (1-mu) / (scale * scale)
effect ~ beta(a, b)
</code></pre></div>
source: https://stackoverflow.com/a/51143208</p>
<p>Example: a mean = 0.2 and variance = 0.1, give a = 20 and b = 80
Plot: https://www.wolframalpha.com/input?i=plot+distribution+of+beta%2820%2C+80%29</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>average_effect</code></td>
        <td><code>Optional[float]</code></td>
        <td><p>the average effect of the treatment. Defaults to None.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>target_col</code></td>
        <td><code>str</code></td>
        <td><p>name of the target_col to use as the outcome. Defaults to "target".</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>treatment_col</code></td>
        <td><code>str</code></td>
        <td><p>the name of the column that contains the treatment. Defaults to "treatment".</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>treatment</code></td>
        <td><code>str</code></td>
        <td><p>name of the treatment to use as the treated group. Defaults to "B".</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>scale</code></td>
        <td><code>Optional[float]</code></td>
        <td><p>the scale of the effect distribution. Defaults to None.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">BetaRelativePositivePerturbator</span><span class="p">(</span><span class="n">NormalPerturbator</span><span class="p">,</span> <span class="n">RelativePositivePerturbator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A stochastic Perturbator for continuous, positively-defined targets that applies a</span>
<span class="sd">    sampled effect from the Beta distribution. It applies the effect multiplicatively.</span>

<span class="sd">    *WARNING*: the average effect is only defined for values between 0 and 1 (not</span>
<span class="sd">    included). Therefore, it only increments the target for the treated samples.</span>

<span class="sd">    The number of samples with 0 as target remains unchanged.</span>

<span class="sd">    The stochastic effect is sampled from a beta distribution with parameters mean and</span>
<span class="sd">    variance. If variance is not provided, the variance is abs(mean). Hence, the effect</span>
<span class="sd">    is bounded by 0 and 1.</span>

<span class="sd">    ```</span>
<span class="sd">    target -&gt; target * (1 + effect), where effect ~ Beta(a, b); a, b &gt; 0</span>
<span class="sd">                                       and target &gt; 0 for all samples</span>
<span class="sd">    ```</span>

<span class="sd">    The common beta parameters are derived from the mean and scale parameters (see</span>
<span class="sd">    how below). That&#39;s why the average effect is only defined for values between 0</span>
<span class="sd">    and 1, otherwise one of the beta parameters would be negative or zero:</span>

<span class="sd">    ```</span>
<span class="sd">    a &lt;- mu / (scale * scale)</span>
<span class="sd">    b &lt;- (1-mu) / (scale * scale)</span>
<span class="sd">    effect ~ beta(a, b)</span>
<span class="sd">    ```</span>
<span class="sd">    source: https://stackoverflow.com/a/51143208</span>

<span class="sd">    Example: a mean = 0.2 and variance = 0.1, give a = 20 and b = 80</span>
<span class="sd">    Plot: https://www.wolframalpha.com/input?i=plot+distribution+of+beta%2820%2C+80%29</span>

<span class="sd">    Arguments:</span>
<span class="sd">        average_effect (Optional[float], optional): the average effect of the treatment. Defaults to None.</span>
<span class="sd">        target_col (str, optional): name of the target_col to use as the outcome. Defaults to &quot;target&quot;.</span>
<span class="sd">        treatment_col (str, optional): the name of the column that contains the treatment. Defaults to &quot;treatment&quot;.</span>
<span class="sd">        treatment (str, optional): name of the treatment to use as the treated group. Defaults to &quot;B&quot;.</span>
<span class="sd">        scale (Optional[float], optional): the scale of the effect distribution. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">perturbate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Usage:</span>
<span class="sd">        ```python</span>
<span class="sd">        from cluster_experiments.perturbator import BetaRelativePositivePerturbator</span>
<span class="sd">        import pandas as pd</span>
<span class="sd">        df = pd.DataFrame({&quot;target&quot;: [1, 2, 3], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
<span class="sd">        perturbator = BetaRelativePositivePerturbator()</span>
<span class="sd">        # Increase target metric by 20%</span>
<span class="sd">        perturbator.perturbate(df, average_effect=0.2)</span>
<span class="sd">        # returns pd.DataFrame({&quot;target&quot;: [1, 3, 3], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">average_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_average_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_beta_positive_effect</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">)</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_scale</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_treated</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">sampled_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sample_beta_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_multiplicative_effect</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">sampled_effect</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">check_beta_positive_effect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_average_effect_greater_than</span><span class="p">(</span><span class="n">average_effect</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_average_effect_less_than</span><span class="p">(</span><span class="n">average_effect</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_target_is_not_negative</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_target_is_not_constant_zero</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">check_average_effect_less_than</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NoReturn</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">average_effect</span> <span class="o">&gt;=</span> <span class="n">x</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Simulated effect needs to be less than </span><span class="si">{</span><span class="n">x</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">%, got &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">average_effect</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sample_beta_effect</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">average_effect</span> <span class="o">/</span> <span class="p">(</span><span class="n">scale</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">average_effect</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">scale</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">











  <div class="doc doc-object doc-method">



<h3 id="cluster_experiments.perturbator.BetaRelativePositivePerturbator.perturbate" class="doc doc-heading">
<code class="highlight language-python"><span class="n">perturbate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#cluster_experiments.perturbator.BetaRelativePositivePerturbator.perturbate" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Usage:
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">cluster_experiments.perturbator</span> <span class="kn">import</span> <span class="n">BetaRelativePositivePerturbator</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;treatment&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">]})</span>
<span class="n">perturbator</span> <span class="o">=</span> <span class="n">BetaRelativePositivePerturbator</span><span class="p">()</span>
<span class="c1"># Increase target metric by 20%</span>
<span class="n">perturbator</span><span class="o">.</span><span class="n">perturbate</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="c1"># returns pd.DataFrame({&quot;target&quot;: [1, 3, 3], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
</code></pre></div></p>

        <details class="quote">
          <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">perturbate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Usage:</span>
<span class="sd">    ```python</span>
<span class="sd">    from cluster_experiments.perturbator import BetaRelativePositivePerturbator</span>
<span class="sd">    import pandas as pd</span>
<span class="sd">    df = pd.DataFrame({&quot;target&quot;: [1, 2, 3], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
<span class="sd">    perturbator = BetaRelativePositivePerturbator()</span>
<span class="sd">    # Increase target metric by 20%</span>
<span class="sd">    perturbator.perturbate(df, average_effect=0.2)</span>
<span class="sd">    # returns pd.DataFrame({&quot;target&quot;: [1, 3, 3], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">average_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_average_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">check_beta_positive_effect</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">)</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_scale</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_treated</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">sampled_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sample_beta_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_multiplicative_effect</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">sampled_effect</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h2 id="cluster_experiments.perturbator.BinaryPerturbator" class="doc doc-heading">
        <code>
BinaryPerturbator            (<a class="autorefs autorefs-internal" title="cluster_experiments.perturbator.Perturbator" href="#cluster_experiments.perturbator.Perturbator">Perturbator</a>)
        </code>



<a href="#cluster_experiments.perturbator.BinaryPerturbator" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>BinaryPerturbator is a Perturbator that adds is used to deal with binary outcome variables.
It randomly selects some treated instances and flips their outcome from 0 to 1 or 1 to 0, depending on the effect being positive or negative</p>

        <details class="quote">
          <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">BinaryPerturbator</span><span class="p">(</span><span class="n">Perturbator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    BinaryPerturbator is a Perturbator that adds is used to deal with binary outcome variables.</span>
<span class="sd">    It randomly selects some treated instances and flips their outcome from 0 to 1 or 1 to 0, depending on the effect being positive or negative</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_sample_max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Like sample without replacement,</span>
<span class="sd">        but if you are to sample more than 100% of the data,</span>
<span class="sd">        it just returns the whole dataframe.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">df</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_data_checks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check that outcome is indeed binary, and average effect is in (-1, 1)&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="o">-</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">}:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Target column must be binary, found </span><span class="si">{</span><span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">average_effect</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">average_effect</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Average effect must be in (-1, 1), found </span><span class="si">{</span><span class="n">average_effect</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">perturbate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Usage:</span>

<span class="sd">        ```python</span>
<span class="sd">        from cluster_experiments.perturbator import BinaryPerturbator</span>
<span class="sd">        import pandas as pd</span>
<span class="sd">        df = pd.DataFrame({&quot;target&quot;: [1, 0, 1], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
<span class="sd">        perturbator = BinaryPerturbator()</span>
<span class="sd">        perturbator.perturbate(df, average_effect=0.1)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">average_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_average_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_data_checks</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">)</span>

        <span class="n">from_target</span><span class="p">,</span> <span class="n">to_target</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">average_effect</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">from_target</span><span class="p">,</span> <span class="n">to_target</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>

        <span class="n">n_transformed</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">average_effect</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treated_query</span><span class="p">))))</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="c1"># Sample of negative cases in group B</span>
            <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="si">}</span><span class="s2"> == </span><span class="si">{</span><span class="n">from_target</span><span class="si">}</span><span class="s2"> &amp; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">treated_query</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sample_max</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_transformed</span><span class="p">)</span>
            <span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_target</span>
        <span class="k">return</span> <span class="n">df</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h3 id="cluster_experiments.perturbator.BinaryPerturbator.perturbate" class="doc doc-heading">
<code class="highlight language-python"><span class="n">perturbate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#cluster_experiments.perturbator.BinaryPerturbator.perturbate" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Usage:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">cluster_experiments.perturbator</span> <span class="kn">import</span> <span class="n">BinaryPerturbator</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;treatment&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">]})</span>
<span class="n">perturbator</span> <span class="o">=</span> <span class="n">BinaryPerturbator</span><span class="p">()</span>
<span class="n">perturbator</span><span class="o">.</span><span class="n">perturbate</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">perturbate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Usage:</span>

<span class="sd">    ```python</span>
<span class="sd">    from cluster_experiments.perturbator import BinaryPerturbator</span>
<span class="sd">    import pandas as pd</span>
<span class="sd">    df = pd.DataFrame({&quot;target&quot;: [1, 0, 1], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
<span class="sd">    perturbator = BinaryPerturbator()</span>
<span class="sd">    perturbator.perturbate(df, average_effect=0.1)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">average_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_average_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_data_checks</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">)</span>

    <span class="n">from_target</span><span class="p">,</span> <span class="n">to_target</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">average_effect</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">from_target</span><span class="p">,</span> <span class="n">to_target</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>

    <span class="n">n_transformed</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">average_effect</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treated_query</span><span class="p">))))</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
        <span class="c1"># Sample of negative cases in group B</span>
        <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="si">}</span><span class="s2"> == </span><span class="si">{</span><span class="n">from_target</span><span class="si">}</span><span class="s2"> &amp; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">treated_query</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sample_max</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_transformed</span><span class="p">)</span>
        <span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_target</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h2 id="cluster_experiments.perturbator.ConstantPerturbator" class="doc doc-heading">
        <code>
ConstantPerturbator            (<a class="autorefs autorefs-internal" title="cluster_experiments.perturbator.Perturbator" href="#cluster_experiments.perturbator.Perturbator">Perturbator</a>)
        </code>



<a href="#cluster_experiments.perturbator.ConstantPerturbator" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>ConstantPerturbator is a Perturbator that adds a constant effect to the target column of the treated instances.</p>

        <details class="quote">
          <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ConstantPerturbator</span><span class="p">(</span><span class="n">Perturbator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ConstantPerturbator is a Perturbator that adds a constant effect to the target column of the treated instances.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">perturbate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Usage:</span>

<span class="sd">        ```python</span>
<span class="sd">        from cluster_experiments.perturbator import ConstantPerturbator</span>
<span class="sd">        import pandas as pd</span>
<span class="sd">        df = pd.DataFrame({&quot;target&quot;: [1, 2, 3], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
<span class="sd">        perturbator = ConstantPerturbator()</span>
<span class="sd">        perturbator.perturbate(df, average_effect=1)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">average_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_average_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_additive_effect</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">apply_additive_effect</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">effect</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">treatment</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">]</span> <span class="o">+=</span> <span class="n">effect</span>
        <span class="k">return</span> <span class="n">df</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h3 id="cluster_experiments.perturbator.ConstantPerturbator.perturbate" class="doc doc-heading">
<code class="highlight language-python"><span class="n">perturbate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#cluster_experiments.perturbator.ConstantPerturbator.perturbate" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Usage:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">cluster_experiments.perturbator</span> <span class="kn">import</span> <span class="n">ConstantPerturbator</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;treatment&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">]})</span>
<span class="n">perturbator</span> <span class="o">=</span> <span class="n">ConstantPerturbator</span><span class="p">()</span>
<span class="n">perturbator</span><span class="o">.</span><span class="n">perturbate</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">perturbate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Usage:</span>

<span class="sd">    ```python</span>
<span class="sd">    from cluster_experiments.perturbator import ConstantPerturbator</span>
<span class="sd">    import pandas as pd</span>
<span class="sd">    df = pd.DataFrame({&quot;target&quot;: [1, 2, 3], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
<span class="sd">    perturbator = ConstantPerturbator()</span>
<span class="sd">    perturbator.perturbate(df, average_effect=1)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">average_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_average_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_additive_effect</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h2 id="cluster_experiments.perturbator.NormalPerturbator" class="doc doc-heading">
        <code>
NormalPerturbator            (<a class="autorefs autorefs-internal" title="cluster_experiments.perturbator.ConstantPerturbator" href="#cluster_experiments.perturbator.ConstantPerturbator">ConstantPerturbator</a>)
        </code>



<a href="#cluster_experiments.perturbator.NormalPerturbator" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>The NormalPerturbator class implements a perturbator that adds a stochastic effect
to the target column of the treated instances. The stochastic effect is sampled from a
normal distribution with mean average_effect and variance scale. If scale is not
provided, the variance is abs(average_effect). If scale is provided, a
value not much bigger than the average_effect is suggested.</p>
<div class="highlight"><pre><span></span><code>target -&gt; target + effect, where effect ~ Normal(average_effect, scale)
</code></pre></div>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>average_effect</code></td>
        <td><code>Optional[float]</code></td>
        <td><p>the average effect of the treatment. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>target_col</code></td>
        <td><code>str</code></td>
        <td><p>name of the target_col to use as the outcome. Defaults to "target".</p></td>
        <td><code>&#39;target&#39;</code></td>
      </tr>
      <tr>
        <td><code>treatment_col</code></td>
        <td><code>str</code></td>
        <td><p>the name of the column that contains the treatment. Defaults to "treatment".</p></td>
        <td><code>&#39;treatment&#39;</code></td>
      </tr>
      <tr>
        <td><code>treatment</code></td>
        <td><code>str</code></td>
        <td><p>name of the treatment to use as the treated group. Defaults to "B".</p></td>
        <td><code>&#39;B&#39;</code></td>
      </tr>
      <tr>
        <td><code>scale</code></td>
        <td><code>Optional[float]</code></td>
        <td><p>the scale of the effect distribution. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">NormalPerturbator</span><span class="p">(</span><span class="n">ConstantPerturbator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The NormalPerturbator class implements a perturbator that adds a stochastic effect</span>
<span class="sd">    to the target column of the treated instances. The stochastic effect is sampled from a</span>
<span class="sd">    normal distribution with mean average_effect and variance scale. If scale is not</span>
<span class="sd">    provided, the variance is abs(average_effect). If scale is provided, a</span>
<span class="sd">    value not much bigger than the average_effect is suggested.</span>

<span class="sd">    ```</span>
<span class="sd">    target -&gt; target + effect, where effect ~ Normal(average_effect, scale)</span>
<span class="sd">    ```</span>

<span class="sd">    Arguments:</span>
<span class="sd">        average_effect (Optional[float], optional): the average effect of the treatment. Defaults to None.</span>
<span class="sd">        target_col (str, optional): name of the target_col to use as the outcome. Defaults to &quot;target&quot;.</span>
<span class="sd">        treatment_col (str, optional): the name of the column that contains the treatment. Defaults to &quot;treatment&quot;.</span>
<span class="sd">        treatment (str, optional): name of the treatment to use as the treated group. Defaults to &quot;B&quot;.</span>
<span class="sd">        scale (Optional[float], optional): the scale of the effect distribution. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;target&quot;</span><span class="p">,</span>
        <span class="n">treatment_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;treatment&quot;</span><span class="p">,</span>
        <span class="n">treatment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span>
        <span class="n">scale</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">average_effect</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">treatment_col</span><span class="p">,</span> <span class="n">treatment</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span> <span class="o">=</span> <span class="n">scale</span>

    <span class="k">def</span> <span class="nf">perturbate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perturbate with a normal effect with mean average_effect and</span>
<span class="sd">        std abs(average_effect).</span>

<span class="sd">        Arguments:</span>
<span class="sd">            df (pd.DataFrame): the dataframe to perturbate.</span>
<span class="sd">            average_effect (Optional[float], optional): the average effect. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: the perturbated dataframe.</span>

<span class="sd">        Usage:</span>

<span class="sd">        ```python</span>
<span class="sd">        from cluster_experiments.perturbator import NormalPerturbator</span>
<span class="sd">        import pandas as pd</span>
<span class="sd">        df = pd.DataFrame({&quot;target&quot;: [1, 2, 3], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
<span class="sd">        perturbator = NormalPerturbator()</span>
<span class="sd">        perturbator.perturbate(df, average_effect=1)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">average_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_average_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_scale</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_treated</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">sampled_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sample_normal_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_additive_effect</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">sampled_effect</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">get_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the scale of the normal distribution. If scale is not provided, the</span>
<span class="sd">        variance is abs(average_effect). Raises a ValueError if scale is not positive.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span>
        <span class="k">if</span> <span class="n">scale</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;scale must be positive, got </span><span class="si">{</span><span class="n">scale</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">scale</span>

    <span class="k">def</span> <span class="nf">get_number_of_treated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the number of treated instances in the dataframe&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">treatment</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_sample_normal_effect</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">average_effect</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a Perturbator object from a PowerConfig object&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">average_effect</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">average_effect</span><span class="p">,</span>
            <span class="n">target_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">target_col</span><span class="p">,</span>
            <span class="n">treatment_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">,</span>
            <span class="n">treatment</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment</span><span class="p">,</span>
            <span class="n">scale</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h3 id="cluster_experiments.perturbator.NormalPerturbator.from_config" class="doc doc-heading">
<code class="highlight language-python"><span class="n">from_config</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#cluster_experiments.perturbator.NormalPerturbator.from_config" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Creates a Perturbator object from a PowerConfig object</p>

        <details class="quote">
          <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a Perturbator object from a PowerConfig object&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">average_effect</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">average_effect</span><span class="p">,</span>
        <span class="n">target_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">target_col</span><span class="p">,</span>
        <span class="n">treatment_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">,</span>
        <span class="n">treatment</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment</span><span class="p">,</span>
        <span class="n">scale</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="cluster_experiments.perturbator.NormalPerturbator.get_number_of_treated" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_number_of_treated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span></code>


<a href="#cluster_experiments.perturbator.NormalPerturbator.get_number_of_treated" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Get the number of treated instances in the dataframe</p>

        <details class="quote">
          <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_number_of_treated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the number of treated instances in the dataframe&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">treatment</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="cluster_experiments.perturbator.NormalPerturbator.get_scale" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">)</span></code>


<a href="#cluster_experiments.perturbator.NormalPerturbator.get_scale" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Get the scale of the normal distribution. If scale is not provided, the
variance is abs(average_effect). Raises a ValueError if scale is not positive.</p>

        <details class="quote">
          <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the scale of the normal distribution. If scale is not provided, the</span>
<span class="sd">    variance is abs(average_effect). Raises a ValueError if scale is not positive.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span>
    <span class="k">if</span> <span class="n">scale</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;scale must be positive, got </span><span class="si">{</span><span class="n">scale</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">scale</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="cluster_experiments.perturbator.NormalPerturbator.perturbate" class="doc doc-heading">
<code class="highlight language-python"><span class="n">perturbate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#cluster_experiments.perturbator.NormalPerturbator.perturbate" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Perturbate with a normal effect with mean average_effect and
std abs(average_effect).</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>df</code></td>
        <td><code>pd.DataFrame</code></td>
        <td><p>the dataframe to perturbate.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>average_effect</code></td>
        <td><code>Optional[float]</code></td>
        <td><p>the average effect. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>pd.DataFrame</code></td>
      <td><p>the perturbated dataframe.</p></td>
    </tr>
  </tbody>
</table>      <p>Usage:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">cluster_experiments.perturbator</span> <span class="kn">import</span> <span class="n">NormalPerturbator</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;treatment&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">]})</span>
<span class="n">perturbator</span> <span class="o">=</span> <span class="n">NormalPerturbator</span><span class="p">()</span>
<span class="n">perturbator</span><span class="o">.</span><span class="n">perturbate</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">perturbate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perturbate with a normal effect with mean average_effect and</span>
<span class="sd">    std abs(average_effect).</span>

<span class="sd">    Arguments:</span>
<span class="sd">        df (pd.DataFrame): the dataframe to perturbate.</span>
<span class="sd">        average_effect (Optional[float], optional): the average effect. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: the perturbated dataframe.</span>

<span class="sd">    Usage:</span>

<span class="sd">    ```python</span>
<span class="sd">    from cluster_experiments.perturbator import NormalPerturbator</span>
<span class="sd">    import pandas as pd</span>
<span class="sd">    df = pd.DataFrame({&quot;target&quot;: [1, 2, 3], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
<span class="sd">    perturbator = NormalPerturbator()</span>
<span class="sd">    perturbator.perturbate(df, average_effect=1)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">average_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_average_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_scale</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_treated</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">sampled_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sample_normal_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_additive_effect</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">sampled_effect</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h2 id="cluster_experiments.perturbator.Perturbator" class="doc doc-heading">
        <code>
Perturbator            (<span title="abc.ABC">ABC</span>)
        </code>



<a href="#cluster_experiments.perturbator.Perturbator" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Abstract perturbator. Perturbators are used to simulate a fictitious effect when running a power analysis.</p>
<p>The idea is that, when running a power analysis, we split our instances according to a RandomSplitter, and the
instances that got the treatment, are perturbated with a fictional effect via the Perturbator.</p>
<p>In order to create your own perturbator, you should create a derived class that implements the perturbate method.
The perturbate method should add the average effect in the desired way and return the dataframe with the extra average effect,
without affecting the initial dataframe. Keep in mind to use <code>df = df.copy()</code> in the first line of the perturbate method.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>average_effect</code></td>
        <td><code>Optional[float]</code></td>
        <td><p>The average effect of the treatment</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>target_col</code></td>
        <td><code>str</code></td>
        <td><p>name of the target_col to use as the outcome</p></td>
        <td><code>&#39;target&#39;</code></td>
      </tr>
      <tr>
        <td><code>treatment_col</code></td>
        <td><code>str</code></td>
        <td><p>The name of the column that contains the treatment</p></td>
        <td><code>&#39;treatment&#39;</code></td>
      </tr>
      <tr>
        <td><code>treatment</code></td>
        <td><code>str</code></td>
        <td><p>name of the treatment to use as the treated group</p></td>
        <td><code>&#39;B&#39;</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Perturbator</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract perturbator. Perturbators are used to simulate a fictitious effect when running a power analysis.</span>

<span class="sd">    The idea is that, when running a power analysis, we split our instances according to a RandomSplitter, and the</span>
<span class="sd">    instances that got the treatment, are perturbated with a fictional effect via the Perturbator.</span>

<span class="sd">    In order to create your own perturbator, you should create a derived class that implements the perturbate method.</span>
<span class="sd">    The perturbate method should add the average effect in the desired way and return the dataframe with the extra average effect,</span>
<span class="sd">    without affecting the initial dataframe. Keep in mind to use `df = df.copy()` in the first line of the perturbate method.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        average_effect: The average effect of the treatment</span>
<span class="sd">        target_col: name of the target_col to use as the outcome</span>
<span class="sd">        treatment_col: The name of the column that contains the treatment</span>
<span class="sd">        treatment: name of the treatment to use as the treated group</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;target&quot;</span><span class="p">,</span>
        <span class="n">treatment_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;treatment&quot;</span><span class="p">,</span>
        <span class="n">treatment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">average_effect</span> <span class="o">=</span> <span class="n">average_effect</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_col</span> <span class="o">=</span> <span class="n">target_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treatment_col</span> <span class="o">=</span> <span class="n">treatment_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treatment</span> <span class="o">=</span> <span class="n">treatment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treated_query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">treatment_col</span><span class="si">}</span><span class="s2"> == &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">treatment</span><span class="si">}</span><span class="s2">&#39;&quot;</span>

    <span class="k">def</span> <span class="nf">get_average_effect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">average_effect</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">average_effect</span> <span class="k">if</span> <span class="n">average_effect</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">average_effect</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">average_effect</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;average_effect must be provided, either in the constructor or in the method call&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">average_effect</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">perturbate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method to perturbate a dataframe&quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a Perturbator object from a PowerConfig object&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">average_effect</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">average_effect</span><span class="p">,</span>
            <span class="n">target_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">target_col</span><span class="p">,</span>
            <span class="n">treatment_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">,</span>
            <span class="n">treatment</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h3 id="cluster_experiments.perturbator.Perturbator.from_config" class="doc doc-heading">
<code class="highlight language-python"><span class="n">from_config</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#cluster_experiments.perturbator.Perturbator.from_config" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Creates a Perturbator object from a PowerConfig object</p>

        <details class="quote">
          <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a Perturbator object from a PowerConfig object&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">average_effect</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">average_effect</span><span class="p">,</span>
        <span class="n">target_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">target_col</span><span class="p">,</span>
        <span class="n">treatment_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">,</span>
        <span class="n">treatment</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-method">



<h3 id="cluster_experiments.perturbator.Perturbator.perturbate" class="doc doc-heading">
<code class="highlight language-python"><span class="n">perturbate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#cluster_experiments.perturbator.Perturbator.perturbate" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Method to perturbate a dataframe</p>

        <details class="quote">
          <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span> <span class="nf">perturbate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method to perturbate a dataframe&quot;&quot;&quot;</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h2 id="cluster_experiments.perturbator.RelativePositivePerturbator" class="doc doc-heading">
        <code>
RelativePositivePerturbator            (<a class="autorefs autorefs-internal" title="cluster_experiments.perturbator.Perturbator" href="#cluster_experiments.perturbator.Perturbator">Perturbator</a>)
        </code>



<a href="#cluster_experiments.perturbator.RelativePositivePerturbator" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>A Perturbator for continuous, positively-defined targets
applies a simulated effect multiplicatively for the treated samples, ie.
proportional to the target value for each sample. The number of samples with 0
as target remains unchanged.</p>
<div class="highlight"><pre><span></span><code>target -&gt; target * (1 + average_effect), where -1 &lt; average_effect &lt; inf
                                           and target &gt; 0 for all samples
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">RelativePositivePerturbator</span><span class="p">(</span><span class="n">Perturbator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Perturbator for continuous, positively-defined targets</span>
<span class="sd">    applies a simulated effect multiplicatively for the treated samples, ie.</span>
<span class="sd">    proportional to the target value for each sample. The number of samples with 0</span>
<span class="sd">    as target remains unchanged.</span>

<span class="sd">    ```</span>
<span class="sd">    target -&gt; target * (1 + average_effect), where -1 &lt; average_effect &lt; inf</span>
<span class="sd">                                               and target &gt; 0 for all samples</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">perturbate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Usage:</span>
<span class="sd">        ```python</span>
<span class="sd">        from cluster_experiments.perturbator import RelativePositivePerturbator</span>
<span class="sd">        import pandas as pd</span>
<span class="sd">        df = pd.DataFrame({&quot;target&quot;: [1, 2, 3], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
<span class="sd">        perturbator = RelativePositivePerturbator()</span>
<span class="sd">        # Increase target metric by 50%</span>
<span class="sd">        perturbator.perturbate(df, average_effect=0.5)</span>
<span class="sd">        # returns pd.DataFrame({&quot;target&quot;: [1, 3, 3], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">average_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_average_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_relative_positive_effect</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_multiplicative_effect</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">check_relative_positive_effect</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_average_effect_greater_than</span><span class="p">(</span><span class="n">average_effect</span><span class="p">,</span> <span class="n">x</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_target_is_not_negative</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_target_is_not_constant_zero</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">check_target_is_not_constant_zero</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NoReturn</span><span class="p">]:</span>
        <span class="n">treatment_zeros</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">treatment</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="k">if</span> <span class="mf">1.0</span> <span class="o">==</span> <span class="n">treatment_zeros</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;All treatment samples have </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="si">}</span><span class="s2"> = 0, relative effect &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">average_effect</span><span class="si">}</span><span class="s2"> will have no effect&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">check_target_is_not_negative</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NoReturn</span><span class="p">]:</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;All </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="si">}</span><span class="s2"> values need to be positive or 0, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;got </span><span class="si">{</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">check_average_effect_greater_than</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NoReturn</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">average_effect</span> <span class="o">&lt;=</span> <span class="n">x</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Simulated effect needs to be greater than </span><span class="si">{</span><span class="n">x</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">%, got &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">average_effect</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_multiplicative_effect</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">effect</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">treatment</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">]</span> <span class="o">*=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">effect</span>
        <span class="k">return</span> <span class="n">df</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">














  <div class="doc doc-object doc-method">



<h3 id="cluster_experiments.perturbator.RelativePositivePerturbator.perturbate" class="doc doc-heading">
<code class="highlight language-python"><span class="n">perturbate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#cluster_experiments.perturbator.RelativePositivePerturbator.perturbate" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Usage:
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">cluster_experiments.perturbator</span> <span class="kn">import</span> <span class="n">RelativePositivePerturbator</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;treatment&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">]})</span>
<span class="n">perturbator</span> <span class="o">=</span> <span class="n">RelativePositivePerturbator</span><span class="p">()</span>
<span class="c1"># Increase target metric by 50%</span>
<span class="n">perturbator</span><span class="o">.</span><span class="n">perturbate</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="c1"># returns pd.DataFrame({&quot;target&quot;: [1, 3, 3], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
</code></pre></div></p>

        <details class="quote">
          <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">perturbate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Usage:</span>
<span class="sd">    ```python</span>
<span class="sd">    from cluster_experiments.perturbator import RelativePositivePerturbator</span>
<span class="sd">    import pandas as pd</span>
<span class="sd">    df = pd.DataFrame({&quot;target&quot;: [1, 2, 3], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
<span class="sd">    perturbator = RelativePositivePerturbator()</span>
<span class="sd">    # Increase target metric by 50%</span>
<span class="sd">    perturbator.perturbate(df, average_effect=0.5)</span>
<span class="sd">    # returns pd.DataFrame({&quot;target&quot;: [1, 3, 3], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">average_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_average_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">check_relative_positive_effect</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_multiplicative_effect</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h2 id="cluster_experiments.perturbator.SegmentedBetaRelativePerturbator" class="doc doc-heading">
        <code>
SegmentedBetaRelativePerturbator            (<a class="autorefs autorefs-internal" title="cluster_experiments.perturbator.BetaRelativePositivePerturbator" href="#cluster_experiments.perturbator.BetaRelativePositivePerturbator">BetaRelativePositivePerturbator</a>)
        </code>



<a href="#cluster_experiments.perturbator.SegmentedBetaRelativePerturbator" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>A stochastic Perturbator for continuous targets that applies a sampled
effect from the Beta distribution. It applies the effect multiplicatively
and based on given segments.
For each segment, the average segment effect is sampled from a beta
distribution with support in (0, 1). Within each segment, the individual
effects are sampled from a beta distribution with mean equal to the segment
average effect and support in (range_min, range_max).</p>
<p>The number of samples with 0 as target remains unchanged.</p>
<p>For additional details and recommendations on the parameters, see the
documentation for the <code>BetaRelativePerturbator</code> class.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>average_effect</code></td>
        <td><code>Optional[float]</code></td>
        <td><p>the average effect of the treatment. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>target_col</code></td>
        <td><code>str</code></td>
        <td><p>name of the target_col to use as the outcome. Defaults to "target".</p></td>
        <td><code>&#39;target&#39;</code></td>
      </tr>
      <tr>
        <td><code>treatment_col</code></td>
        <td><code>str</code></td>
        <td><p>the name of the column that contains the treatment. Defaults to "treatment".</p></td>
        <td><code>&#39;treatment&#39;</code></td>
      </tr>
      <tr>
        <td><code>treatment</code></td>
        <td><code>str</code></td>
        <td><p>name of the treatment to use as the treated group. Defaults to "B".</p></td>
        <td><code>&#39;B&#39;</code></td>
      </tr>
      <tr>
        <td><code>scale</code></td>
        <td><code>Optional[float]</code></td>
        <td><p>the scale of the effect distribution. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>range_min</code></td>
        <td><code>float</code></td>
        <td><p>the minimum value of the target range, must be &gt;-1.
Defaults to -0.8, which allows for up to 5x decreases of the target.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>range_max</code></td>
        <td><code>float</code></td>
        <td><p>the maximum value of the target range.
Defaults to 4, which allows for up to 5x increases of the target.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>segment_cols</code></td>
        <td><code>Optional[List[str]]</code></td>
        <td><p>the columns to use for segmenting. Defaults to None.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">SegmentedBetaRelativePerturbator</span><span class="p">(</span><span class="n">BetaRelativePositivePerturbator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A stochastic Perturbator for continuous targets that applies a sampled</span>
<span class="sd">    effect from the Beta distribution. It applies the effect multiplicatively</span>
<span class="sd">    and based on given segments.</span>
<span class="sd">    For each segment, the average segment effect is sampled from a beta</span>
<span class="sd">    distribution with support in (0, 1). Within each segment, the individual</span>
<span class="sd">    effects are sampled from a beta distribution with mean equal to the segment</span>
<span class="sd">    average effect and support in (range_min, range_max).</span>

<span class="sd">    The number of samples with 0 as target remains unchanged.</span>

<span class="sd">    For additional details and recommendations on the parameters, see the</span>
<span class="sd">    documentation for the `BetaRelativePerturbator` class.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        average_effect (Optional[float], optional): the average effect of the treatment. Defaults to None.</span>
<span class="sd">        target_col (str, optional): name of the target_col to use as the outcome. Defaults to &quot;target&quot;.</span>
<span class="sd">        treatment_col (str, optional): the name of the column that contains the treatment. Defaults to &quot;treatment&quot;.</span>
<span class="sd">        treatment (str, optional): name of the treatment to use as the treated group. Defaults to &quot;B&quot;.</span>
<span class="sd">        scale (Optional[float], optional): the scale of the effect distribution. Defaults to None.</span>
<span class="sd">        range_min (float, optional): the minimum value of the target range, must be &gt;-1.</span>
<span class="sd">            Defaults to -0.8, which allows for up to 5x decreases of the target.</span>
<span class="sd">        range_max (float, optional): the maximum value of the target range.</span>
<span class="sd">            Defaults to 4, which allows for up to 5x increases of the target.</span>
<span class="sd">        segment_cols (Optional[List[str]], optional): the columns to use for segmenting. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">segment_cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;target&quot;</span><span class="p">,</span>
        <span class="n">treatment_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;treatment&quot;</span><span class="p">,</span>
        <span class="n">treatment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span>
        <span class="n">scale</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">range_min</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">range_max</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">average_effect</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">treatment_col</span><span class="p">,</span> <span class="n">treatment</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_range_min</span> <span class="o">=</span> <span class="n">range_min</span> <span class="ow">or</span> <span class="o">-</span><span class="mf">0.8</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_range_max</span> <span class="o">=</span> <span class="n">range_max</span> <span class="ow">or</span> <span class="mi">4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_segment_cols</span> <span class="o">=</span> <span class="n">segment_cols</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">segment_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_segment_col_name</span><span class="p">(</span><span class="n">segment_cols</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_segment_col_name</span><span class="p">(</span><span class="n">segment_cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">segment_cols</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;segment_cols must be of type List[str], got type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">segment_cols</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;_cluster_&quot;</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">segment_cols</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_segment_col_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Cannot use </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_col</span><span class="si">=}</span><span class="s2"> as perturbator clustering &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;column, as it already exists in the input dataframe!&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
            <span class="o">**</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_col</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_segment_cols</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)}</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_cluster_perturbator_fixed_params</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">average_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_average_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_average_effect_greater_than</span><span class="p">(</span><span class="n">average_effect</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_average_effect_less_than</span><span class="p">(</span><span class="n">average_effect</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_scale</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;average_effect&quot;</span><span class="p">:</span> <span class="n">average_effect</span><span class="p">,</span>
            <span class="s2">&quot;scale&quot;</span><span class="p">:</span> <span class="n">scale</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">get_cluster_perturbator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Perturbator</span><span class="p">:</span>
        <span class="n">sampled_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sample_beta_effect</span><span class="p">(</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;average_effect&quot;</span><span class="p">],</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;scale&quot;</span><span class="p">],</span> <span class="mi">1</span>
        <span class="p">)</span>
        <span class="n">cluster_perturbator</span> <span class="o">=</span> <span class="n">BetaRelativePerturbator</span><span class="p">(</span>
            <span class="n">average_effect</span><span class="o">=</span><span class="n">sampled_effect</span><span class="p">,</span>
            <span class="n">target_col</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">,</span>
            <span class="n">treatment_col</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">,</span>
            <span class="n">treatment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">treatment</span><span class="p">,</span>
            <span class="n">range_min</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_range_min</span><span class="p">,</span>
            <span class="n">range_max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_range_max</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">cluster_perturbator</span>

    <span class="k">def</span> <span class="nf">perturbate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_segment_col_values</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="n">cluster_perturbator_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cluster_perturbator_fixed_params</span><span class="p">(</span>
            <span class="n">average_effect</span>
        <span class="p">)</span>
        <span class="n">df_perturbed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_cluster_perturbator</span><span class="p">(</span><span class="o">**</span><span class="n">cluster_perturbator_params</span><span class="p">)</span><span class="o">.</span><span class="n">perturbate</span><span class="p">(</span>
                    <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_col</span><span class="p">]</span> <span class="o">==</span> <span class="n">cluster</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_col</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">df_perturbed</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_col</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a Perturbator object from a PowerConfig object&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">average_effect</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">average_effect</span><span class="p">,</span>
            <span class="n">target_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">target_col</span><span class="p">,</span>
            <span class="n">treatment_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">,</span>
            <span class="n">treatment</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment</span><span class="p">,</span>
            <span class="n">scale</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span>
            <span class="n">range_min</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">range_min</span><span class="p">,</span>
            <span class="n">range_max</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">range_max</span><span class="p">,</span>
            <span class="n">segment_cols</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">segment_cols</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h3 id="cluster_experiments.perturbator.SegmentedBetaRelativePerturbator.from_config" class="doc doc-heading">
<code class="highlight language-python"><span class="n">from_config</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#cluster_experiments.perturbator.SegmentedBetaRelativePerturbator.from_config" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Creates a Perturbator object from a PowerConfig object</p>

        <details class="quote">
          <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a Perturbator object from a PowerConfig object&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">average_effect</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">average_effect</span><span class="p">,</span>
        <span class="n">target_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">target_col</span><span class="p">,</span>
        <span class="n">treatment_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">,</span>
        <span class="n">treatment</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment</span><span class="p">,</span>
        <span class="n">scale</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span>
        <span class="n">range_min</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">range_min</span><span class="p">,</span>
        <span class="n">range_max</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">range_max</span><span class="p">,</span>
        <span class="n">segment_cols</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">segment_cols</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 id="cluster_experiments.perturbator.SegmentedBetaRelativePerturbator.perturbate" class="doc doc-heading">
<code class="highlight language-python"><span class="n">perturbate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#cluster_experiments.perturbator.SegmentedBetaRelativePerturbator.perturbate" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Usage:
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">cluster_experiments.perturbator</span> <span class="kn">import</span> <span class="n">BetaRelativePositivePerturbator</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;treatment&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">]})</span>
<span class="n">perturbator</span> <span class="o">=</span> <span class="n">BetaRelativePositivePerturbator</span><span class="p">()</span>
<span class="c1"># Increase target metric by 20%</span>
<span class="n">perturbator</span><span class="o">.</span><span class="n">perturbate</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="c1"># returns pd.DataFrame({&quot;target&quot;: [1, 3, 3], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
</code></pre></div></p>

        <details class="quote">
          <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">perturbate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_segment_col_values</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="n">cluster_perturbator_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cluster_perturbator_fixed_params</span><span class="p">(</span>
        <span class="n">average_effect</span>
    <span class="p">)</span>
    <span class="n">df_perturbed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_cluster_perturbator</span><span class="p">(</span><span class="o">**</span><span class="n">cluster_perturbator_params</span><span class="p">)</span><span class="o">.</span><span class="n">perturbate</span><span class="p">(</span>
                <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_col</span><span class="p">]</span> <span class="o">==</span> <span class="n">cluster</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_col</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">df_perturbed</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_col</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h2 id="cluster_experiments.perturbator.UniformPerturbator" class="doc doc-heading">
        <code>
UniformPerturbator            (<a class="autorefs autorefs-internal" title="cluster_experiments.perturbator.Perturbator" href="#cluster_experiments.perturbator.Perturbator">Perturbator</a>)
        </code>



<a href="#cluster_experiments.perturbator.UniformPerturbator" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>UniformPerturbator is a Perturbator that adds a constant effect to the target column of the treated instances.</p>

        <details class="quote">
          <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">UniformPerturbator</span><span class="p">(</span><span class="n">Perturbator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    UniformPerturbator is a Perturbator that adds a constant effect to the target column of the treated instances.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;target&quot;</span><span class="p">,</span>
        <span class="n">treatment_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;treatment&quot;</span><span class="p">,</span>
        <span class="n">treatment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">average_effect</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">treatment_col</span><span class="p">,</span> <span class="n">treatment</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;UniformPerturbator is deprecated and will be removed in future versions. &quot;</span>
            <span class="s2">&quot;Use ConstantPerturbator instead.&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">perturbate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Usage:</span>

<span class="sd">        ```python</span>
<span class="sd">        from cluster_experiments.perturbator import UniformPerturbator</span>
<span class="sd">        import pandas as pd</span>
<span class="sd">        df = pd.DataFrame({&quot;target&quot;: [1, 2, 3], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
<span class="sd">        perturbator = UniformPerturbator()</span>
<span class="sd">        perturbator.perturbate(df, average_effect=1)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">average_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_average_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_additive_effect</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">apply_additive_effect</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">effect</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">treatment</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">]</span> <span class="o">+=</span> <span class="n">effect</span>
        <span class="k">return</span> <span class="n">df</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">











  <div class="doc doc-object doc-method">



<h3 id="cluster_experiments.perturbator.UniformPerturbator.perturbate" class="doc doc-heading">
<code class="highlight language-python"><span class="n">perturbate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#cluster_experiments.perturbator.UniformPerturbator.perturbate" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Usage:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">cluster_experiments.perturbator</span> <span class="kn">import</span> <span class="n">UniformPerturbator</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;treatment&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">]})</span>
<span class="n">perturbator</span> <span class="o">=</span> <span class="n">UniformPerturbator</span><span class="p">()</span>
<span class="n">perturbator</span><span class="o">.</span><span class="n">perturbate</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">perturbate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Usage:</span>

<span class="sd">    ```python</span>
<span class="sd">    from cluster_experiments.perturbator import UniformPerturbator</span>
<span class="sd">    import pandas as pd</span>
<span class="sd">    df = pd.DataFrame({&quot;target&quot;: [1, 2, 3], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
<span class="sd">    perturbator = UniformPerturbator()</span>
<span class="sd">    perturbator.perturbate(df, average_effect=1)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">average_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_average_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_additive_effect</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="experiment_analysis.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Experiment analysis" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Experiment analysis
            </div>
          </div>
        </a>
      
      
        
        <a href="random_splitter.html" class="md-footer__link md-footer__link--next" aria-label="Next: Splitter" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Splitter
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2022 Maintained by David Masip.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.48f2be22.min.js"></script>
      
    
  </body>
</html>